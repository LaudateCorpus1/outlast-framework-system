{% extends 'admin/base-jquery.html' %}

{% block submenu %}
	<a class='btn btn-success' href='add/'>{{#admin_new#}}</a>
	{% if current_category %}<a class='btn' href='add/?parentcategory={{current_category.id}}'>{{#admin_new_in_cat#}}</a>{% endif %}
	
	<select class="pull-right" id="category-box" name="category" onchange="$('search-box').value = ''; zaj.redirect('/admin/category/?category='+$$('#category-box')[0].value);">
		<option value="">- {{#main_category#}} -</option>
		<option value="all">- {{#all_category#}} -</option>
	</select>
	{% if zaj.get.category %}
		<script>$$('#category-box')[0].value = '{{zaj.get.category|escape:'js'}}';</script>
	{% endif %}

	<input id="search-box" class="pull-right" type="text" placeholder="{{#admin_search#}}">
	
	<script language="javascript">
		zaj.ready(function(){
			$('search-box').$zaj().search('/admin/category/', 'admincontent');
		});
	</script>

	<hr/>	
{% endblock submenu %}

{% block selectmenu %}
	<script language="javascript">$('users-menu').addClass('active');</script>
{% endblock %}

{% block content %}

	<p align="center">{{objects.pagination.prev}} | {{#admin_found#|printf:objects.total}} | {{objects.pagination.next}}</p>

	
	<h3>Főkategória &gt; {% if current_category %}{{current_category.hierarchy}} <a href="{{baseurl}}admin/category/?category={{current_category.data.parentcategory.id}}" class="btn pull-right">{{#category_up#}}</a>{% endif %}</h3>
	

	<table class="table table-striped table-hover">
		<tbody>
			{% foreach objects as object %}
				<tr id='{{object.id}}'>
					<td>
						{% if object.parentcategoryname %} {{object.parentcategoryname}} / {% endif %}<a href='{{baseurl}}admin/category/?category={{object.id}}'>{{object.name}}</a> - ({{#subcategories#|printf:object.count}})
					</td>
					<td>
						<a class="btn btn-small btn-danger pull-right" onclick="if(confirm('{{#admin_delete#}}')) window.location='{{baseurl}}admin/category/delete/?id={{object.id}}';"><i class="icon-trash icon-white"></i></a>
						<a class="btn btn-small pull-right" style="margin-right: 5px;" href="{{baseurl}}admin/category/edit/?id={{object.id}}"><i class="icon-pencil"></i> {{#admin_edit#}}</a>
						<a class="btn btn-small pull-right" style="margin-right: 5px;" href="{{baseurl}}admin/category/?category={{object.id}}">{{#enter_category#}}</a>
					</td>
				</tr>
			{% elsefor %}
				-  {{#admin_none_found#}} -
			{% endforeach %}
		</tbody>
	</table>

	<script language="JavaScript" src="{{baseurl}}system/js/jquery/jquery-ui-1.9.2/js/jquery-ui-1.9.2.custom.min.js" type="text/javascript"></script>
	<!--[if lt IE 8]>
	<script src="{{baseurl}}system/js/json2.js"></script>
	<![endif]-->

	<script language="javascript">

		zaj.ready(function(){
			// Make sortable
			$('table tbody').sortable({
			    start: function(event, ui) {
			    	ui.item.addClass('draginprogress');
			    },
			    stop: function(event, ui) {
			    	ui.item.removeClass('draginprogress');
					// Build array
						var my_array = [];
						$('table tbody').children().each(function(){
							my_array.push(this.id);
						});
						zaj.ajax.post('/admin/category/reorder/?reorder='+JSON.stringify(my_array));
			    }
			});
		});

	</script>



	<p align="center">{{objects.pagination.prev}} {{objects.pagination.next}}</p>

{% endblock content %} 
